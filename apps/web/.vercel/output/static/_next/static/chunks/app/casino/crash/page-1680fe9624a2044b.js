(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[376],{167:(e,t,r)=>{"use strict";r.d(t,{Balance:()=>l});var a=r(8481),s=r(8521),n=r(8526);function l(e){let{initialBalance:t}=e,{displayBalance:r,intensity:l}=(0,s.A)(t),i=(0,n.useMemo)(()=>{if(l<.1)return{};let e=3*l,t=+l;return{animation:l>.3?"shake ".concat(.1-.05*l,"s infinite"):"none",transform:"translate(".concat((Math.random()-.5)*e,"px, ").concat((Math.random()-.5)*e,"px) rotate(").concat((Math.random()-.5)*t,"deg)")}},[l]),c=(0,n.useMemo)(()=>l>.7?"text-green-400":l>.4?"text-green-200":"text-[var(--text)]",[l]);return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 border-y border-[var(--line)] w-full bg-[rgba(255,255,255,0.02)]",children:[(0,a.jsx)("p",{className:"text-[0.7rem] text-[var(--text-muted)] mb-2 uppercase tracking-widest",children:"solde"}),(0,a.jsxs)("div",{className:"text-[2.5rem] font-light leading-none tracking-tight transition-colors duration-100 ".concat(c),style:i,children:[(0,a.jsx)("span",{className:"tabular-nums",children:r.toFixed(2)}),(0,a.jsx)("span",{className:"text-[var(--text-muted)] text-[1.2rem] ml-1",children:"€"})]})]})}},1523:(e,t,r)=>{"use strict";r.d(t,{CrashGameClient:()=>N});var a=r(8481),s=r(4816),n=r.n(s),l=r(8526);function i(e){let{state:t,multiplier:r,crashPoint:s,countdown:n,startTime:i}=e,c=(0,l.useRef)(null),o=(0,l.useRef)(null),d=(0,l.useRef)([]),u=(0,l.useRef)(1),x=(0,l.useMemo)(()=>({background:"#0a0a0a",grid:"rgba(85, 85, 85, 0.3)",line:"crashed"===t?"#ef4444":"#22c55e",lineGlow:"crashed"===t?"rgba(239, 68, 68, 0.5)":"rgba(34, 197, 94, 0.6)"}),[t]);return(0,l.useEffect)(()=>{"waiting"===t&&(d.current=[],u.current=1)},[t]),(0,l.useEffect)(()=>{if("running"===t&&r>u.current){let e=Math.min((i?Date.now()-i:0)/300,100);d.current.push({x:e,y:r}),u.current=r,d.current.length>300&&(d.current=d.current.slice(-300))}},[r,t,i]),(0,l.useEffect)(()=>{let e=c.current,a=o.current;if(!e||!a)return;let s=e.getContext("2d");if(!s)return;let n=a.getBoundingClientRect(),l=window.devicePixelRatio||1;e.width=n.width*l,e.height=n.height*l,e.style.width="".concat(n.width,"px"),e.style.height="".concat(n.height,"px"),s.scale(l,l);let i=n.width,u=n.height,h=i-60-40,m=u-40-40;s.fillStyle=x.background,s.fillRect(0,0,i,u),s.strokeStyle=x.grid,s.lineWidth=1;let f=Math.max(1.3*r,2);for(let e=1;e<=f;e+=f>10?5:f>5?2:1){let t=40+m-e/f*m;s.beginPath(),s.moveTo(60,t),s.lineTo(i-40,t),s.stroke(),s.fillStyle="#888",s.font="11px monospace",s.textAlign="right",s.fillText("".concat(e.toFixed(1),"x"),50,t+4)}let p=d.current;if(p.length>1){s.shadowColor=x.lineGlow,s.shadowBlur=15,s.strokeStyle=x.line,s.lineWidth=3,s.lineCap="round",s.lineJoin="round",s.beginPath(),p.forEach((e,t)=>{let r=60+e.x/100*h,a=40+m-e.y/f*m;0===t?s.moveTo(r,a):s.lineTo(r,a)}),s.stroke();let e=s.createLinearGradient(0,40,0,u-40);e.addColorStop(0,"crashed"===t?"rgba(239, 68, 68, 0.2)":"rgba(34, 197, 94, 0.2)"),e.addColorStop(1,"transparent"),s.shadowBlur=0,s.fillStyle=e,s.beginPath(),p.forEach((e,t)=>{let r=60+e.x/100*h,a=40+m-e.y/f*m;0===t?s.moveTo(r,a):s.lineTo(r,a)});let r=60+p[p.length-1].x/100*h;if(s.lineTo(r,u-40),s.lineTo(60,u-40),s.closePath(),s.fill(),"running"===t){let e=p[p.length-1],t=60+e.x/100*h,r=40+m-e.y/f*m;s.beginPath(),s.arc(t,r,6,0,2*Math.PI),s.fillStyle=x.line,s.shadowColor=x.lineGlow,s.shadowBlur=10,s.fill()}}},[r,t,x]),(0,l.useEffect)(()=>{let e=()=>{let e=c.current;if(e){let t=e.getContext("2d");t&&t.clearRect(0,0,e.width,e.height)}};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.jsxs)("div",{className:"relative w-full h-full min-h-[300px]",ref:o,children:[(0,a.jsx)("canvas",{ref:c,className:"absolute inset-0 w-full h-full"}),(0,a.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:["waiting"===t&&void 0!==n&&(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-[4rem] font-light tabular-nums text-[var(--text)] animate-pulse",children:[n,"s"]}),(0,a.jsx)("span",{className:"text-sm uppercase tracking-widest text-[var(--text-muted)]",children:"prochaine partie"})]}),"running"===t&&(0,a.jsxs)("span",{className:"text-[5rem] font-light tabular-nums",style:{color:r>=2?"#22c55e":"#e0e0e0",textShadow:r>=2?"0 0 30px rgba(34, 197, 94, 0.5)":"none"},children:[r.toFixed(2),"x"]}),"crashed"===t&&(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm uppercase tracking-widest text-red-400",children:"crashed"}),(0,a.jsxs)("span",{className:"text-[5rem] font-light tabular-nums text-red-500",style:{textShadow:"0 0 30px rgba(239, 68, 68, 0.5)"},children:[(s||r).toFixed(2),"x"]})]})]})]})}var c=r(9607),o=r(4176),d=r(5806),u=r(2620);function x(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,u.QP)((0,d.$)(t))}let h=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),m=l.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:l=!1,...i}=e,o=l?c.DX:"button";return(0,a.jsx)(o,{className:x(h({variant:s,size:n,className:r})),ref:t,...i})});m.displayName="Button";let f=l.forwardRef((e,t)=>{let{className:r,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:x("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});f.displayName="Input";var p=r(6951);let g=(0,p.createServerReference)("401c0006b53a25c51f86d12a99803ae22a699d54dd",p.callServer,void 0,p.findSourceMapURL,"placeCrashBet"),v=(0,p.createServerReference)("008318713b1f2e87603dc8bd4e5167c2abfcd397ab",p.callServer,void 0,p.findSourceMapURL,"cashOutCrash");var b=r(8521);function j(e){var t,r;let{gameState:s,userBet:n,currentMultiplier:i,userBalance:c}=e,[o,d]=(0,l.useState)("1"),[u,x]=(0,l.useTransition)(),[h,p]=(0,l.useState)(null),[j,w]=(0,l.useState)(null),{setBalance:N}=(0,b.A)(c),y=n&&!n.cashedOut?(n.bet*i*.95).toFixed(2):null;return(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-4 border border-[var(--line)] bg-[rgba(255,255,255,0.02)]",children:[h&&(0,a.jsx)("div",{className:"p-2 text-sm text-red-400 border border-red-500/30 bg-red-500/10 text-center",children:h}),j&&(0,a.jsx)("div",{className:"p-2 text-sm text-green-400 border border-green-500/30 bg-green-500/10 text-center",children:j}),!n&&"waiting"===s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-[0.7rem] uppercase tracking-widest text-[var(--text-muted)]",children:"mise (€)"}),(0,a.jsx)(f,{type:"number",min:"0.5",step:"0.5",value:o,onChange:e=>d(e.target.value),className:"bg-[var(--bg)] border-[var(--line)] text-[var(--text)] font-mono",placeholder:"1.00"})]}),(0,a.jsx)("div",{className:"flex gap-2",children:[.5,1,2,5,10].map(e=>(0,a.jsxs)("button",{onClick:()=>d(e.toString()),className:"flex-1 py-1.5 text-xs border border-[var(--line)] hover:border-[var(--text-muted)] hover:bg-[rgba(255,255,255,0.03)] transition-all",children:[e,"€"]},e))}),(0,a.jsx)(m,{onClick:()=>{p(null),w(null);let e=parseFloat(o);if(isNaN(e)||e<=0)return void p("montant invalide");x(async()=>{let t=await g(e);t.success?(w("pari plac\xe9!"),N((parseFloat(c)-e).toFixed(2))):p(t.error||"erreur")})},disabled:u||"waiting"!==s,className:"w-full py-6 text-lg bg-green-600 hover:bg-green-500 text-white font-medium",children:u?"...":"parier"})]}),n&&!n.cashedOut&&"waiting"===s&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-sm text-[var(--text-muted)]",children:"pari plac\xe9"}),(0,a.jsxs)("p",{className:"text-2xl font-mono mt-2",children:[n.bet,"€"]}),(0,a.jsx)("p",{className:"text-xs text-[var(--text-muted)] mt-2",children:"en attente..."})]}),n&&!n.cashedOut&&"running"===s&&(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-xs text-[var(--text-muted)] uppercase tracking-widest",children:"gain potentiel"}),(0,a.jsxs)("p",{className:"text-3xl font-mono mt-1 text-green-400",style:{textShadow:"0 0 10px rgba(34, 197, 94, 0.5)"},children:[y,"€"]})]}),(0,a.jsx)(m,{onClick:()=>{x(async()=>{let e=await v();if(e.success){var t,r;w("cashout x".concat(null==(t=e.multiplier)?void 0:t.toFixed(2)," (+").concat(null==(r=e.profit)?void 0:r.toFixed(2),"€)")),void 0!==e.newBalance&&N(e.newBalance.toFixed(2))}else p(e.error||"erreur")})},disabled:u,className:"w-full py-8 text-xl bg-green-500 hover:bg-green-400 text-white font-bold animate-pulse",children:u?"...":"CASHOUT ".concat(y,"€")})]}),(null==n?void 0:n.cashedOut)&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-sm text-green-400 uppercase tracking-widest",children:"cashout r\xe9ussi!"}),(0,a.jsxs)("p",{className:"text-3xl font-mono mt-2 text-green-400",children:["x",null==(t=n.cashOutMultiplier)?void 0:t.toFixed(2)]}),(0,a.jsxs)("p",{className:"text-lg font-mono mt-1",children:["+",null==(r=n.profit)?void 0:r.toFixed(2),"€"]})]}),n&&!n.cashedOut&&"crashed"===s&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-sm text-red-400 uppercase tracking-widest",children:"perdu"}),(0,a.jsxs)("p",{className:"text-3xl font-mono mt-2 text-red-400",children:["-",n.bet,"€"]})]}),!n&&"running"===s&&(0,a.jsxs)("div",{className:"text-center py-8 text-[var(--text-muted)]",children:[(0,a.jsx)("p",{className:"text-sm uppercase tracking-widest",children:"paris ferm\xe9s"}),(0,a.jsx)("p",{className:"text-xs mt-2",children:"attends la prochaine partie"})]}),!n&&"crashed"===s&&(0,a.jsx)("div",{className:"text-center py-8 text-[var(--text-muted)]",children:(0,a.jsx)("p",{className:"text-sm",children:"prochaine partie dans quelques secondes..."})})]})}var w=r(167);function N(e){let{userId:t,userBalance:r,userName:s}=e,{gameState:c,isConnected:o,userBet:d}=function(e){let[t,r]=(0,l.useState)(null),[a,s]=(0,l.useState)(!1),n=(0,l.useRef)(null),i=(0,l.useRef)(null),c=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/crash",{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(e.ok){let t=await e.json();r(t),i.current=t,s(!0)}}catch(e){console.error("Fetch error:",e),s(!1)}},[]);(0,l.useEffect)(()=>{c();let e=()=>{var t;let r=null==(t=i.current)?void 0:t.state;n.current&&clearInterval(n.current),n.current=setInterval(()=>{c(),e()},"running"===r?100:"waiting"===r?500:300)};return e(),()=>{n.current&&clearInterval(n.current)}},[c]);let o=e?null==t?void 0:t.players.find(t=>t.odrzerId===e):void 0;return{gameState:t,isConnected:a,userBet:o,refetch:c}}(t);return c?(0,a.jsx)(b.BalanceProvider,{initialBalance:r,children:(0,a.jsxs)("main",{className:"min-h-screen flex flex-col",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-[var(--line)]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(n(),{href:"/dashboard",className:"text-[var(--text-muted)] hover:text-[var(--text)] transition-colors text-sm",children:"← retour"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(o?"bg-green-500":"bg-red-500")}),(0,a.jsx)("span",{className:"text-sm text-[var(--text-muted)]",children:"crash"})]})]}),(0,a.jsx)("div",{className:"text-sm text-[var(--text-muted)]",children:s.toLowerCase()})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col lg:flex-row",children:[(0,a.jsx)("div",{className:"flex-1 h-[50vh] lg:h-auto relative",children:(0,a.jsx)(i,{state:c.state,multiplier:c.currentMultiplier,crashPoint:c.crashPoint,countdown:c.countdown,startTime:c.startTime})}),(0,a.jsxs)("div",{className:"w-full lg:w-80 border-t lg:border-t-0 lg:border-l border-[var(--line)] flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b border-[var(--line)]",children:(0,a.jsx)(w.Balance,{initialBalance:r})}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:(0,a.jsx)(j,{gameState:c.state,userBet:d,currentMultiplier:c.currentMultiplier,userBalance:r})}),(0,a.jsxs)("div",{className:"border-t border-[var(--line)] p-4 max-h-48 overflow-auto",children:[(0,a.jsxs)("p",{className:"text-[0.7rem] uppercase tracking-widest text-[var(--text-muted)] mb-3",children:["joueurs (",c.players.length,")"]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[0===c.players.length&&(0,a.jsx)("p",{className:"text-xs text-[var(--text-muted)]",children:"aucun joueur"}),c.players.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs p-2 border border-[var(--line)] ".concat(e.cashedOut?"bg-green-500/10 border-green-500/30":"crashed"===c.state?"bg-red-500/10 border-red-500/30":""),children:[(0,a.jsx)("span",{className:"truncate max-w-[100px]",children:e.odrzerame.toLowerCase()}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-[var(--text-muted)]",children:[e.bet,"€"]}),e.cashedOut&&(0,a.jsxs)("span",{className:"text-green-400",children:["x",null==(t=e.cashOutMultiplier)?void 0:t.toFixed(2)]}),!e.cashedOut&&"crashed"===c.state&&(0,a.jsx)("span",{className:"text-red-400",children:"\uD83D\uDCA5"})]})]},e.odrzerId)})]})]})]})]})]})}):(0,a.jsx)("main",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-pulse text-[var(--text-muted)]",children:"chargement..."})})}},8380:(e,t,r)=>{Promise.resolve().then(r.bind(r,1523))},8521:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,BalanceProvider:()=>l});var a=r(8481),s=r(8526);let n=(0,s.createContext)(null);function l(e){let{children:t,initialBalance:r}=e,[l,i]=(0,s.useState)(r),[c,o]=(0,s.useState)(parseFloat(r)),[d,u]=(0,s.useState)(0),x=(0,s.useRef)([]),h=(0,s.useRef)(null),m=(0,s.useCallback)((e,t)=>{h.current&&cancelAnimationFrame(h.current);let r=performance.now(),a=s=>{let n=Math.min((s-r)/150,1);o(e+(t-e)*(1-Math.pow(1-n,3))),n<1&&(h.current=requestAnimationFrame(a))};h.current=requestAnimationFrame(a)},[]),f=(0,s.useCallback)(e=>{m(c,parseFloat(e)),i(e)},[c,m]),p=(0,s.useCallback)(e=>{let t=Date.now();x.current.push(t),x.current=x.current.filter(e=>t-e<1e3),u(Math.min(x.current.length/12,1)),i(t=>{let r=parseFloat(t)+e;return m(c,r),r.toFixed(2)})},[c,m]);(0,s.useEffect)(()=>{let e=setInterval(()=>{u(e=>e<=.01?0:.85*e)},50);return()=>clearInterval(e)},[]);let g=(0,s.useCallback)(async()=>{try{let e=await fetch("/api/balance"),t=await e.json(),r=parseFloat(t.balance);m(c,r),i(t.balance)}catch(e){}},[c,m]);return(0,a.jsx)(n.Provider,{value:{balance:l,displayBalance:c,intensity:d,setBalance:f,addToBalance:p,refreshBalance:g},children:t})}function i(e){let t=(0,s.useContext)(n),[r,a]=(0,s.useState)(e),[l,i]=(0,s.useState)(parseFloat(e)),c=(0,s.useCallback)(e=>{a(t=>{let r=parseFloat(t)+e;return i(r),r.toFixed(2)})},[]),o=(0,s.useCallback)(async()=>{try{let e=await fetch("/api/balance"),t=await e.json();a(t.balance),i(parseFloat(t.balance))}catch(e){}},[]);return t||{balance:r,displayBalance:l,intensity:0,setBalance:a,addToBalance:c,refreshBalance:o}}}},e=>{e.O(0,[816,465,59,498,358],()=>e(e.s=8380)),_N_E=e.O()}]);