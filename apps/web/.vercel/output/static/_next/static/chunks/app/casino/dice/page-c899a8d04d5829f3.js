(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[210],{167:(e,t,a)=>{"use strict";a.d(t,{Balance:()=>n});var r=a(8481),l=a(8521),s=a(8526);function n(e){let{initialBalance:t}=e,{displayBalance:a,intensity:n}=(0,l.A)(t),c=(0,s.useMemo)(()=>{if(n<.1)return{};let e=3*n,t=+n;return{animation:n>.3?"shake ".concat(.1-.05*n,"s infinite"):"none",transform:"translate(".concat((Math.random()-.5)*e,"px, ").concat((Math.random()-.5)*e,"px) rotate(").concat((Math.random()-.5)*t,"deg)")}},[n]),i=(0,s.useMemo)(()=>n>.7?"text-green-400":n>.4?"text-green-200":"text-[var(--text)]",[n]);return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 border-y border-[var(--line)] w-full bg-[rgba(255,255,255,0.02)]",children:[(0,r.jsx)("p",{className:"text-[0.7rem] text-[var(--text-muted)] mb-2 uppercase tracking-widest",children:"solde"}),(0,r.jsxs)("div",{className:"text-[2.5rem] font-light leading-none tracking-tight transition-colors duration-100 ".concat(i),style:c,children:[(0,r.jsx)("span",{className:"tabular-nums",children:a.toFixed(2)}),(0,r.jsx)("span",{className:"text-[var(--text-muted)] text-[1.2rem] ml-1",children:"€"})]})]})}},3084:(e,t,a)=>{Promise.resolve().then(a.bind(a,9609))},6951:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{callServer:function(){return r.callServer},createServerReference:function(){return s.createServerReference},findSourceMapURL:function(){return l.findSourceMapURL}});let r=a(7932),l=a(8208),s=a(1212)},8521:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,BalanceProvider:()=>n});var r=a(8481),l=a(8526);let s=(0,l.createContext)(null);function n(e){let{children:t,initialBalance:a}=e,[n,c]=(0,l.useState)(a),[i,o]=(0,l.useState)(parseFloat(a)),[d,x]=(0,l.useState)(0),u=(0,l.useRef)([]),m=(0,l.useRef)(null),p=(0,l.useCallback)((e,t)=>{m.current&&cancelAnimationFrame(m.current);let a=performance.now(),r=l=>{let s=Math.min((l-a)/150,1);o(e+(t-e)*(1-Math.pow(1-s,3))),s<1&&(m.current=requestAnimationFrame(r))};m.current=requestAnimationFrame(r)},[]),v=(0,l.useCallback)(e=>{p(i,parseFloat(e)),c(e)},[i,p]),b=(0,l.useCallback)(e=>{let t=Date.now();u.current.push(t),u.current=u.current.filter(e=>t-e<1e3),x(Math.min(u.current.length/12,1)),c(t=>{let a=parseFloat(t)+e;return p(i,a),a.toFixed(2)})},[i,p]);(0,l.useEffect)(()=>{let e=setInterval(()=>{x(e=>e<=.01?0:.85*e)},50);return()=>clearInterval(e)},[]);let h=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/balance"),t=await e.json(),a=parseFloat(t.balance);p(i,a),c(t.balance)}catch(e){}},[i,p]);return(0,r.jsx)(s.Provider,{value:{balance:n,displayBalance:i,intensity:d,setBalance:v,addToBalance:b,refreshBalance:h},children:t})}function c(e){let t=(0,l.useContext)(s),[a,r]=(0,l.useState)(e),[n,c]=(0,l.useState)(parseFloat(e)),i=(0,l.useCallback)(e=>{r(t=>{let a=parseFloat(t)+e;return c(a),a.toFixed(2)})},[]),o=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/balance"),t=await e.json();r(t.balance),c(parseFloat(t.balance))}catch(e){}},[]);return t||{balance:a,displayBalance:n,intensity:0,setBalance:r,addToBalance:i,refreshBalance:o}}},9381:(e,t,a)=>{"use strict";a.d(t,{M:()=>l});var r=a(6951);let l=(0,r.createServerReference)("00022d10447c8c48e3a6f966bba0c216e4cdca899d",r.callServer,void 0,r.findSourceMapURL,"getAvailablePlayers")},9609:(e,t,a)=>{"use strict";a.d(t,{DiceGameClient:()=>f});var r=a(8481),l=a(8526),s=a(4816),n=a.n(s),c=a(9381),i=a(6951);let o=(0,i.createServerReference)("00d35aca69f9e2fb596002a72a7704c873c9febea8",i.callServer,void 0,i.findSourceMapURL,"getPendingDiceChallenges"),d=(0,i.createServerReference)("4036cb1152c52d5d21d77294b16c0d1e769176e629",i.callServer,void 0,i.findSourceMapURL,"playDiceVsBot"),x=(0,i.createServerReference)("605e150c1eb09dba79fd4a52a4aec21c8a1d5f7dc0",i.callServer,void 0,i.findSourceMapURL,"createDiceChallenge"),u=(0,i.createServerReference)("406dd37bea0acb89ab5135e2b141cfe63323db5a8b",i.callServer,void 0,i.findSourceMapURL,"acceptDiceChallenge");var m=a(167),p=a(8521);let v=["⚀","⚁","⚂","⚃","⚄","⚅"];function b(e){let{finalValue:t,isRolling:a,delay:s=0}=e,[n,c]=(0,l.useState)(v[0]),i=(0,l.useRef)(null),o=(0,l.useRef)(null);return(0,l.useEffect)(()=>(a?o.current=setTimeout(()=>{let e=0,a=20+10*Math.random(),r=()=>{c(v[Math.floor(6*Math.random())]),++e<a?i.current=setTimeout(r,50+15*e):t&&c(v[t-1])};r()},s):t?c(v[t-1]):c(v[0]),()=>{i.current&&clearTimeout(i.current),o.current&&clearTimeout(o.current)}),[a,t,s]),(0,r.jsx)("span",{className:"select-none",children:n})}function h(e){var t,a,s,i,v,h,f,j,g;let{userBalance:N,userName:y}=e,[w,S]=(0,l.useState)("bot"),[R,k]=(0,l.useState)("1"),[C,F]=(0,l.useState)(!1),[D,M]=(0,l.useState)(null),[B,L]=(0,l.useState)(!1),{refreshBalance:P}=(0,p.A)(N),[U,A]=(0,l.useState)([]),[_,E]=(0,l.useState)({sent:[],received:[]}),[T,I]=(0,l.useState)(null);(0,l.useEffect)(()=>{if("pvp"===w){V();let e=setInterval(V,5e3);return()=>clearInterval(e)}},[w]);let V=async()=>{let[e,t]=await Promise.all([(0,c.M)(),o()]);A(e),E(t)},O=async()=>{let e=parseFloat(R);if(isNaN(e)||e<.5)return;F(!0),M(null),L(!0);let t=await d(e);M(t),await new Promise(e=>setTimeout(e,1800)),L(!1),F(!1),t.success&&P()},q=async e=>{let t=parseFloat(R);isNaN(t)||t<.5||(F(!0),await x(e.id,t),F(!1),V())},G=async e=>{F(!0),I(null),L(!0),await new Promise(e=>setTimeout(e,1500));let t=await u(e.id);L(!1),F(!1),t.success&&(I({won:void 0!==t.winnerId&&t.profit>0,tie:null===t.winnerId,myRoll:t.player2Roll,theirRoll:t.player1Roll,profit:t.profit}),P(),V())},z=D?D.won?"win":D.tie?"tie":"lose":"idle";return(0,r.jsxs)("main",{className:"min-h-screen flex flex-col",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-[var(--line)]",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(n(),{href:"/casino",className:"text-[var(--text-muted)] hover:text-[var(--text)] transition-colors text-sm",children:"← casino"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-500"}),(0,r.jsx)("span",{className:"text-sm text-[var(--text-muted)]",children:"dice"})]})]}),(0,r.jsx)("div",{className:"text-sm text-[var(--text-muted)]",children:y.toLowerCase()})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col lg:flex-row",children:[(0,r.jsx)("div",{className:"flex-1 h-[50vh] lg:h-auto relative flex items-center justify-center bg-[rgba(255,255,255,0.01)]",children:"bot"===w?(0,r.jsxs)("div",{className:"flex flex-col items-center gap-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-8 lg:gap-16",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)("span",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-[var(--text-muted)]",children:"toi"}),(0,r.jsxs)("div",{className:"flex gap-2 text-6xl lg:text-8xl",children:[(0,r.jsx)(b,{finalValue:null!=(h=null==D||null==(t=D.playerDice)?void 0:t[0])?h:null,isRolling:B,delay:0}),(0,r.jsx)(b,{finalValue:null!=(f=null==D||null==(a=D.playerDice)?void 0:a[1])?f:null,isRolling:B,delay:100})]}),(null==D?void 0:D.playerRoll)&&!B&&(0,r.jsx)("span",{className:"text-4xl font-mono font-bold",children:D.playerRoll}),B&&(0,r.jsx)("span",{className:"text-4xl font-mono opacity-20",children:"--"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,r.jsx)("div",{className:"w-px h-16 bg-[var(--line)]"}),(0,r.jsx)("span",{className:"text-xs text-[var(--text-muted)] font-light",children:"vs"}),(0,r.jsx)("div",{className:"w-px h-16 bg-[var(--line)]"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)("span",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-[var(--text-muted)]",children:"bot"}),(0,r.jsxs)("div",{className:"flex gap-2 text-6xl lg:text-8xl",children:[(0,r.jsx)(b,{finalValue:null!=(j=null==D||null==(s=D.botDice)?void 0:s[0])?j:null,isRolling:B,delay:200}),(0,r.jsx)(b,{finalValue:null!=(g=null==D||null==(i=D.botDice)?void 0:i[1])?g:null,isRolling:B,delay:300})]}),(null==D?void 0:D.botRoll)&&!B&&(0,r.jsx)("span",{className:"text-4xl font-mono font-bold",children:D.botRoll}),B&&(0,r.jsx)("span",{className:"text-4xl font-mono opacity-20",children:"--"})]})]}),D&&D.success&&!B&&(0,r.jsx)("div",{className:"px-8 py-3 ".concat("win"===z?"bg-green-500/10 border border-green-500/30":"tie"===z?"bg-yellow-500/10 border border-yellow-500/30":"bg-red-500/10 border border-red-500/30"),children:(0,r.jsxs)("span",{className:"text-sm font-mono ".concat("win"===z?"text-green-400":"tie"===z?"text-yellow-400":"text-red-400"),children:["win"===z&&"+",null==(v=D.profit)?void 0:v.toFixed(2),"e"]})}),D&&!D.success&&(0,r.jsx)("div",{className:"px-8 py-3 bg-red-500/10 border border-red-500/30",children:(0,r.jsx)("span",{className:"text-sm text-red-400",children:D.error})})]}):(0,r.jsx)("div",{className:"w-full max-w-md px-6",children:T?(0,r.jsxs)("div",{className:"flex flex-col items-center gap-6",children:[(0,r.jsx)("div",{className:"text-6xl",children:T.won?"\uD83C\uDFC6":T.tie?"\uD83E\uDD1D":"\uD83D\uDCA8"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"text-2xl font-mono mb-1",children:[T.myRoll," vs ",T.theirRoll]}),(0,r.jsxs)("p",{className:"text-lg font-mono ".concat(T.won?"text-green-400":T.tie?"text-yellow-400":"text-red-400"),children:[T.profit>0?"+":"",T.profit.toFixed(2),"e"]})]}),(0,r.jsx)("button",{onClick:()=>I(null),className:"text-sm text-[var(--text-muted)] hover:text-[var(--text)]",children:"continuer"})]}):_.received.length>0||_.sent.length>0?(0,r.jsxs)("div",{className:"space-y-6",children:[_.received.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-[var(--text-muted)] mb-3",children:"defis recus"}),_.received.map(e=>{var t,a;return(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border border-[var(--line)] mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm",children:null==(a=e.player1)||null==(t=a.discordUsername)?void 0:t.toLowerCase()}),(0,r.jsxs)("p",{className:"text-xs text-[var(--text-muted)] font-mono",children:[String(e.amount),"e"]})]}),(0,r.jsx)("button",{onClick:()=>G(e),disabled:C,className:"px-4 py-2 text-xs uppercase tracking-wider bg-green-500/20 text-green-400 border border-green-500/50 hover:bg-green-500/30 disabled:opacity-50",children:"jouer"})]},e.id)})]}),_.sent.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-[var(--text-muted)] mb-3",children:"en attente"}),_.sent.map(e=>{var t,a;return(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border border-[var(--line)] opacity-60 mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm",children:null==(a=e.player2)||null==(t=a.discordUsername)?void 0:t.toLowerCase()}),(0,r.jsxs)("p",{className:"text-xs text-[var(--text-muted)] font-mono",children:[String(e.amount),"e"]})]}),(0,r.jsx)("span",{className:"text-xs text-[var(--text-muted)]",children:"..."})]},e.id)})]})]}):(0,r.jsxs)("div",{className:"text-center text-[var(--text-muted)]",children:[(0,r.jsx)("p",{className:"text-4xl mb-4 opacity-20",children:"\uD83C\uDFB2"}),(0,r.jsx)("p",{className:"text-sm",children:"defie un joueur depuis le panel"})]})})}),(0,r.jsxs)("div",{className:"w-full lg:w-72 border-t lg:border-t-0 lg:border-l border-[var(--line)] flex flex-col",children:[(0,r.jsx)("div",{className:"p-4 border-b border-[var(--line)]",children:(0,r.jsx)(m.Balance,{initialBalance:N})}),(0,r.jsxs)("div",{className:"flex border-b border-[var(--line)]",children:[(0,r.jsx)("button",{onClick:()=>{S("bot"),M(null)},className:"flex-1 py-2.5 text-[0.65rem] uppercase tracking-[0.15em] transition-colors ".concat("bot"===w?"text-[var(--text)] bg-[rgba(255,255,255,0.03)]":"text-[var(--text-muted)] hover:text-[var(--text)]"),children:"vs bot"}),(0,r.jsx)("button",{onClick:()=>{S("pvp"),M(null),I(null)},className:"flex-1 py-2.5 text-[0.65rem] uppercase tracking-[0.15em] transition-colors ".concat("pvp"===w?"text-[var(--text)] bg-[rgba(255,255,255,0.03)]":"text-[var(--text-muted)] hover:text-[var(--text)]"),children:"vs joueur"})]}),(0,r.jsxs)("div",{className:"p-4 flex-1",children:[(0,r.jsx)("p",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-[var(--text-muted)] mb-3",children:"mise"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,r.jsx)("input",{type:"number",value:R,onChange:e=>k(e.target.value),min:"0.5",step:"0.5",disabled:C,className:"flex-1 px-3 py-2.5 bg-transparent border border-[var(--line)] text-center font-mono focus:outline-none focus:border-[var(--text-muted)] disabled:opacity-50"}),(0,r.jsx)("span",{className:"text-[var(--text-muted)] text-sm",children:"e"})]}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-1.5 mb-4",children:[.5,1,2,5].map(e=>(0,r.jsx)("button",{onClick:()=>k(e.toString()),disabled:C,className:"py-1.5 text-[0.65rem] border border-[var(--line)] hover:border-[var(--text-muted)] disabled:opacity-50 transition-colors font-mono",children:e},e))}),"bot"===w?(0,r.jsx)("button",{onClick:O,disabled:C||.5>parseFloat(R),className:"w-full py-3 bg-[var(--text)] text-[var(--bg)] text-xs uppercase tracking-[0.15em] hover:opacity-90 disabled:opacity-50 transition-opacity",children:C?"...":"lancer"}):(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-[var(--text-muted)] mb-2 mt-2",children:"joueurs"}),(0,r.jsx)("div",{className:"flex flex-col gap-1.5 max-h-[200px] overflow-auto",children:0===U.length?(0,r.jsx)("p",{className:"text-xs text-[var(--text-muted)] text-center py-4",children:"aucun"}):U.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 border border-[var(--line)] hover:border-[var(--text-muted)] transition-colors",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("p",{className:"text-xs truncate",children:e.name.toLowerCase()}),(0,r.jsxs)("p",{className:"text-[0.6rem] text-[var(--text-muted)] font-mono",children:[e.balance.toFixed(0),"e"]})]}),(0,r.jsx)("button",{onClick:()=>q(e),disabled:C||.5>parseFloat(R),className:"px-2 py-1 text-[0.6rem] uppercase border border-[var(--line)] hover:border-[var(--text-muted)] disabled:opacity-50",children:"go"})]},e.id))})]})]}),(0,r.jsxs)("div",{className:"p-4 border-t border-[var(--line)] text-[0.6rem] text-[var(--text-muted)] space-y-0.5",children:[(0,r.jsx)("p",{children:"2d6 chacun"}),(0,r.jsx)("p",{children:"plus haut score gagne x1.9"}),(0,r.jsx)("p",{children:"egalite rembourse -5%"})]})]})]})]})}function f(e){let{userBalance:t,userName:a}=e;return(0,r.jsx)(p.BalanceProvider,{initialBalance:t,children:(0,r.jsx)(h,{userBalance:t,userName:a})})}}},e=>{e.O(0,[816,59,498,358],()=>e(e.s=3084)),_N_E=e.O()}]);